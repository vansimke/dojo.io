<% /*
	Table of contents for docs layout

	format
	============================================
	{
		title: "name"
		icon: "titleicon"
		categories: [
			{ title: "category title", topics: [
				{ name: "topic", url: "https://example.org" }
			] }
		]
	}
*/
const source = locals.src;
const data = site.data[source];
const groupName = data.group || locals.src;
const section = page.path.split('/')[0];
%>
<aside class="menu docs" data-group-name="<%- groupName %>">
	<%
	function printCategory(category) { %>
		<p class="menu-label">
			<%- category.title %>
		</p>
		<ul class="menu-list">
			<% for (let topic of category.topics) { %>
			<li><a href="<%- topic.url %>"><%- topic.name %></a></li>
			<% } %>
		</ul>
	<% }

	function printTopicHeader(topic) { %>
		<p class="menu-label">
			<%- topic.name %>
		</p>
	<% }

	if (data.title) { %>
		<div class="title">
			<i class="<%- data.icon %>"></i>
			<span class="title"><%- data.title %></span>
		</div>
	<% } %>
	<% for (let item of data.contents) {
		if (item.title) {
			printCategory(item);
		}
		else {
			printTopicHeader(item);
		}
	} %>
</aside>
<script>
	window.addEventListener('load', function () {
		function updateMenu() {
			var menu = document.querySelector('.menu');

			var nodes = menu.querySelectorAll('.is-active');
			for (var i = 0; i < nodes.length; i++) {
				nodes[i].classList.remove('is-active');
			}

			var hashPath = location.hash.substr(0, location.hash.lastIndexOf('/'));
			var activeLink = menu.querySelector('.menu-list li a[href^="' + location.pathname + hashPath + '"]');

			if (activeLink) {
				activeLink.classList.add('is-active');
				activeLink.parentElement.classList.add('is-active');
				var groupList = activeLink.parentElement.parentElement;
				groupList.classList.add('is-active');
				groupList.previousElementSibling.classList.add('is-active');
			}

		}
		var labels = document.querySelectorAll('.menu.docs .menu-label');
		for (var i = 0; i < labels.length; i++) {
			var elem = labels[i];
			elem.addEventListener('click', function(e) {
				var firstLink = e.target.nextElementSibling.querySelector('a:first-child');
				location = firstLink.getAttribute('href');
				updateMenu();
			});
		}
		window.addEventListener('hashchange', updateMenu);

		updateMenu();
	});
</script>
